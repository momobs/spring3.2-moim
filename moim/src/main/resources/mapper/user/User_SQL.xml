<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="user">
<!-- 로그인: START -->
	<select id="selectLoginInfo" parameterType="String" resultType="moim.user.vo.LoginVO">
		<![CDATA[
			SELECT A.USER_ID, A.USER_PWD, A.USER_NAME, A.EMAIL,  A.PHONE, A.ADDRESS, A.INTRO, A.CREATE_DATE, A.CREATE_USER, A.DELETE_DATE, A.DELETE_USER, A.USER_PHOTO,
					IFNULL(B.GROUP_IDX,'')+'-'+IFNULL(B.FILE_IDX,'')+'.'+IFNULL(B.EXTENSION,'') AS PHOTO_NAME
			FROM USER A 
				LEFT JOIN FILE_MASTER B ON  (B.GROUP_IDX='1' AND A.USER_PHOTO = B.FILE_IDX )
			WHERE A.USER_ID = #{user_id}
			AND IFNULL(A.DEL_YN, 'N') = 'N'		
		]]>
	</select>
<!-- 로그인: END -->

<!-- 아이디/비밀번호 검색: START -->
	<select id="selectUserId" parameterType="String" resultType="String">
		<![CDATA[
			SELECT USER_ID 
			FROM USER
			WHERE USER_ID = #{user_id}
			AND IFNULL(DEL_YN, 'N') = 'N'
		]]>
	</select>


	<select id="selectUserPwd" parameterType="moim.user.vo.UserVO" resultType="java.lang.String">
		<![CDATA[
			SELECT
				USER_PWD
			FROM 
				USER
			WHERE
				USER_ID = #{user_id}
		]]>
	</select>
<!-- 아이디/비밀번호 검색: END -->

	<select id="selectUser" parameterType="moim.user.vo.UserVO" resultType="moim.user.vo.UserVO">
		<![CDATA[
			SELECT
				USER_ID,
				USER_PWD,
				USER_NAME,
				EMAIL,
				PHONE,
				ADDRESS,
				INTRO
			FROM
				USER
			WHERE
				USER_ID = #{user_id}
		]]>
	</select>


	
	<insert id="insertUser" parameterType="moim.user.vo.UserVO" >
		<![CDATA[
			INSERT INTO USER
			(
				USER_ID,
				USER_PWD,
				USER_NAME,
				EMAIL,
				PHONE,
				ADDRESS,
				CREATE_DATE,
				CREATE_USER
			)
			VALUES
			(
				#{user_id},
				#{user_pwd},
				#{user_name},
				#{email},
				#{phone},
				#{address},
				now(),
				#{user_id}
			)
		]]>
	</insert>
<!-- 회원정보 변경: START -->	
	<update id="updateUser" parameterType="moim.user.vo.UserVO">
		<![CDATA[
			UPDATE USER
			SET USER_NAME = #{user_name},
				EMAIL = #{email},
				PHONE = #{phone},
				ADDRESS = #{address}
			WHERE USER_ID = #{user_id}
		]]>
	</update>
	
	<update id="updateUserPwd" parameterType="hashmap">
		<![CDATA[
			UPDATE USER
			SET USER_PWD = #{new_password}
			WHERE USER_ID = #{login.user_id}
			AND IFNULL(DEL_YN,'N')='N'
		]]>
	</update>
	
	<update id="updateUserPhoto" parameterType="hashmap">
		<![CDATA[
			UPDATE USER
			SET USER_PHOTO = #{idx}
			WHERE USER_ID = #{user_id}
		]]>
	</update>
<!-- 회원정보 변경: END -->
</mapper>